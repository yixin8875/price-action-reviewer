{% extends "admin/base_site.html" %}
{% load static %}

{% block title %}{{ title }}{% endblock %}

{% block extrastyle %}
<link rel="stylesheet" href="{% static 'admin/css/custom_admin.css' %}">
<style>
    .chart-container {
        width: 100%;
        height: 600px;
        margin: 20px 0;
    }
    .control-panel {
        background: #f8f9fa;
        padding: 15px;
        margin: 20px 0;
        border-radius: 5px;
    }
    .control-panel label {
        margin-right: 10px;
        font-weight: bold;
    }
    .control-panel select {
        padding: 5px 10px;
        margin-right: 20px;
    }
</style>
{% endblock %}

{% block content %}
<div id="content-main">
    <h1>{{ title }}</h1>

    <div class="control-panel">
        <label>周期选择:</label>
        <select id="period-selector">
            <option value="1d" {% if period == '1d' %}selected{% endif %}>日线</option>
            <option value="1w" {% if period == '1w' %}selected{% endif %}>周线</option>
            <option value="1M" {% if period == '1M' %}selected{% endif %}>月线</option>
        </select>

        <label>技术指标:</label>
        <label><input type="checkbox" id="show-ma" checked> MA均线</label>
    </div>

    <div id="kline-chart" class="chart-container"></div>

    <div style="margin-top: 20px;">
        <a href="{% url 'admin:market_data_instrument_changelist' %}" class="button">返回列表</a>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
<script>
    // 初始化图表
    var chartDom = document.getElementById('kline-chart');
    var myChart = echarts.init(chartDom);
    var option = {{ chart_option|safe }};

    myChart.setOption(option);

    // 响应式调整
    window.addEventListener('resize', function() {
        myChart.resize();
    });

    // 周期切换
    document.getElementById('period-selector').addEventListener('change', function(e) {
        var period = e.target.value;
        window.location.href = '?period=' + period;
    });

    // MA指标开关（预留接口）
    document.getElementById('show-ma').addEventListener('change', function(e) {
        var series = option.series;
        var showMA = e.target.checked;

        series.forEach(function(s) {
            if (s.name.startsWith('MA')) {
                s.show = showMA;
            }
        });

        myChart.setOption(option);
    });
</script>
{% endblock %}
